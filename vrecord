#/bin/bash
middleoptions=""
echo -n "Enter Identifier: "
read id
echo -n "Enter Directory: "
read dir
if [ ! -d "$dir" ] ; then 
    echo "error not a valid directory"
    exit
fi
echo "Capture Options: "
echo "a) 10 bit with 2 channels in stereo and 2 channels in mono"
echo "b) 8 bit with 2 channels in stereo and 2 channels in mono"
echo "c) 10 bit with 2 channels in stereo" 
echo -n "enter your option: "
read captureopt
if [ "${captureopt}" = "a" ] ; then 
    bitdepth=10
    middleoptions+=(-c:v v210)
elif [ "${captureopt}" = "b" ] ; then
    bitdepth=8
    middleoptions=(-c:v rawvideo -pix_fmt uyvy422 -tag:v 2vuy)
elif [ "${captureopt}" = "c" ] ; then
    bitdepth=10
    middleoptions=(-c:v v210)
else 
    echo "error not a valid option"
    exit
fi
echo "Video Input Options: "
echo "a) Composite"
echo "b) SDI"
echo -n "enter your option: "
read videoinput
if [ "${videoinput}" = "a" ] ; then 
    videoinput=1
    videoinputname=composite
elif [ "${videoinput}" = "b" ] ; then 
    videoinput=4
    videoinputname=SDI
else
    echo "error not a valid video input option"    
    exit
fi        
echo
echo "The selected bitdepth is ${bitdepth} and the set video input is ${videoinputname} and will capture to ${dir}/${id}.mov"
echo Hit enter to start
read
echo "hit control-c to stop"
bmdcapture -m 0 -V "${videoinput}" -A 2 -c 8 -s 32 -p "${bitdepth}" -F nut -f pipe:1 | ffmpeg -v verbose -i - ${middleoptions[@]} -c:a pcm_s24le -vf setfield=bff,setsar=40/27,setdar=4/3  "${dir}/${id}.mov" -c copy -f nut - | ffplay -
